# =============================================================================
# Orbo Helm Values - GPU Environment (NVIDIA GPU)
# =============================================================================
# Usage: helm install orbo ./helm/orbo -f values-gpu.yaml
# =============================================================================

# -----------------------------------------------------------------------------
# Global Settings
# -----------------------------------------------------------------------------
global:
  environment: production
  logLevel: info

# -----------------------------------------------------------------------------
# Main Orbo Application
# -----------------------------------------------------------------------------
orbo:
  replicaCount: 1

  image:
    repository: orbo
    tag: latest
    pullPolicy: IfNotPresent

  # Server configuration
  server:
    host: "0.0.0.0"
    httpPort: 8080
    debug: false

  # Resource limits
  resources:
    limits:
      cpu: 500m
      memory: 1Gi
    requests:
      cpu: 200m
      memory: 512Mi

  # Security context
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    runAsGroup: 1000
    fsGroup: 1000
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: true
    capabilities:
      drop: [ALL]

# -----------------------------------------------------------------------------
# Detection Configuration
# -----------------------------------------------------------------------------
detection:
  # Primary detector: basic, yolo, or dinov3
  primaryDetector: yolo
  fallbackEnabled: true

  # Basic motion detection settings
  motion:
    enabled: true
    minConfidence: 0.5
    minContourArea: 1000
    backgroundHistory: 500
    varThreshold: 16

# -----------------------------------------------------------------------------
# YOLO Service (GPU Enabled)
# -----------------------------------------------------------------------------
yolo:
  enabled: true
  replicaCount: 1

  image:
    repository: orbo-yolo
    tag: latest
    pullPolicy: IfNotPresent

  # Detection settings
  config:
    confidenceThreshold: 0.5
    securityMode: true
    classesFilter: ""  # Empty = all classes
    drawBoxes: true
    model: yolov8n.pt

  # Service configuration
  service:
    type: ClusterIP
    port: 8081

  # GPU-accelerated resources
  resources:
    limits:
      nvidia.com/gpu: 1
      cpu: 2000m
      memory: 4Gi
    requests:
      nvidia.com/gpu: 1
      cpu: 1000m
      memory: 2Gi

  # Security context
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    runAsGroup: 1000
    fsGroup: 1000
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: false
    capabilities:
      drop: [ALL]

  # GPU settings (enabled for production)
  gpu:
    enabled: true
    cudaDevices: "0"
    nodeSelector:
      nvidia.com/gpu.present: "true"

  # Scheduling
  nodeSelector:
    nvidia.com/gpu.present: "true"
  tolerations: []
  affinity: {}

# -----------------------------------------------------------------------------
# DINOv3 Service (Disabled by default)
# -----------------------------------------------------------------------------
dinov3:
  enabled: false
  replicaCount: 1

  image:
    repository: orbo-dinov3
    tag: latest
    pullPolicy: Always

  config:
    motionThreshold: 0.85
    confidenceThreshold: 0.6
    fallbackToBasic: true
    enableSceneAnalysis: true

  service:
    type: ClusterIP
    port: 8001

  resources:
    limits:
      nvidia.com/gpu: 1
      cpu: 2000m
      memory: 4Gi
    requests:
      nvidia.com/gpu: 1
      cpu: 1000m
      memory: 2Gi

  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    runAsGroup: 1000
    fsGroup: 1000
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: false
    capabilities:
      drop: [ALL]

  gpu:
    enabled: true
    cudaDevices: "0"
    nodeSelector:
      nvidia.com/gpu.present: "true"

  nodeSelector:
    nvidia.com/gpu.present: "true"
  tolerations: []
  affinity: {}

# -----------------------------------------------------------------------------
# Notifications
# -----------------------------------------------------------------------------
notifications:
  telegram:
    enabled: false
    botToken: ""
    chatId: ""
    cooldownSeconds: 30

# -----------------------------------------------------------------------------
# Storage
# -----------------------------------------------------------------------------
storage:
  # Persistent volume for frames and database
  persistence:
    enabled: true
    storageClass: ""
    accessMode: ReadWriteOnce
    size: 10Gi
    mountPath: /app/frames

  # Database
  database:
    path: /app/frames/orbo.db

  # Frame storage
  frames:
    path: /app/frames

# -----------------------------------------------------------------------------
# Camera Configuration
# -----------------------------------------------------------------------------
camera:
  devicePath: /dev/video0
  privileged: false

# -----------------------------------------------------------------------------
# Networking
# -----------------------------------------------------------------------------
service:
  type: ClusterIP
  port: 8080

ingress:
  enabled: true
  className: nginx
  annotations: {}
  hosts:
    - host: app.orbo.local
      paths:
        - path: /
          pathType: Prefix
  tls: []

# -----------------------------------------------------------------------------
# Health Checks
# -----------------------------------------------------------------------------
probes:
  liveness:
    enabled: true
    path: /healthz
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  readiness:
    enabled: true
    path: /readyz
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3

# -----------------------------------------------------------------------------
# Autoscaling
# -----------------------------------------------------------------------------
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 3
  targetCPUUtilizationPercentage: 80

# -----------------------------------------------------------------------------
# Service Account
# -----------------------------------------------------------------------------
serviceAccount:
  create: true
  annotations: {}
  name: ""

# -----------------------------------------------------------------------------
# Secrets (Use external secrets in production)
# -----------------------------------------------------------------------------
secrets:
  telegramBotToken: ""
  telegramChatId: ""
