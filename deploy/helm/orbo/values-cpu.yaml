# =============================================================================
# Orbo Helm Values - CPU-Only Environment (No GPU)
# =============================================================================
# Usage: helm install orbo ./helm/orbo -f values-cpu.yaml
# =============================================================================

# -----------------------------------------------------------------------------
# Global Settings
# -----------------------------------------------------------------------------
global:
  environment: production
  logLevel: info

# -----------------------------------------------------------------------------
# Main Orbo Application
# -----------------------------------------------------------------------------
orbo:
  replicaCount: 1

  image:
    repository: orbo
    tag: latest
    pullPolicy: IfNotPresent

  # Server configuration
  server:
    host: "0.0.0.0"
    httpPort: 8080
    debug: false

  # Resource limits
  resources:
    limits:
      cpu: 500m
      memory: 1Gi
    requests:
      cpu: 200m
      memory: 512Mi

  # Security context
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    runAsGroup: 1000
    fsGroup: 1000
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: true
    capabilities:
      drop: [ALL]

# -----------------------------------------------------------------------------
# Authentication
# -----------------------------------------------------------------------------
auth:
  enabled: false
  username: admin
  password: ""
  jwtSecret: ""  # Leave empty for random secret
  jwtExpiry: 24h

# -----------------------------------------------------------------------------
# Detection Pipeline Configuration (Global Defaults)
# -----------------------------------------------------------------------------
detection:
  # Detection mode: disabled, continuous, motion_triggered, scheduled, hybrid
  mode: motion_triggered

  # Execution mode: sequential (YOLO → Face → Plate chain) or parallel (all at once)
  executionMode: sequential

  # Enabled detectors (order matters for sequential mode)
  # Note: face detection disabled by default for CPU-only (resource intensive)
  detectors:
    - yolo

  # Scheduled/hybrid mode interval (e.g., "5s", "10s")
  scheduleInterval: 5s

  # Motion detection settings (for motion_triggered and hybrid modes)
  motion:
    enabled: true
    sensitivity: 0.1
    cooldownSeconds: 2
    minContourArea: 1000
    backgroundHistory: 500
    varThreshold: 16

  # Legacy settings (kept for backwards compatibility)
  primaryDetector: yolo
  fallbackEnabled: true

# -----------------------------------------------------------------------------
# YOLO Service (CPU-Only)
# -----------------------------------------------------------------------------
yolo:
  enabled: true
  replicaCount: 1

  image:
    repository: orbo-yolo
    tag: latest
    pullPolicy: IfNotPresent

  # Detection settings
  config:
    confidenceThreshold: 0.5
    securityMode: true
    classesFilter: ""  # Empty = all classes
    drawBoxes: true
    model: yolo11n.pt  # YOLO11 nano (fastest) - alternatives: yolo11s.pt, yolo11m.pt
    enabledTasks: "detect,segment,pose"  # YOLO11 tasks: detect, segment, pose, obb, classify

  # Service configuration
  service:
    type: ClusterIP
    port: 8081

  # CPU-only resources (no GPU)
  resources:
    limits:
      cpu: 2000m
      memory: 4Gi
    requests:
      cpu: 1000m
      memory: 2Gi

  # Security context
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    runAsGroup: 1000
    fsGroup: 1000
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: false
    capabilities:
      drop: [ALL]

  # GPU settings (disabled)
  gpu:
    enabled: false
    cudaDevices: "0"
    nodeSelector: {}

  # Scheduling
  nodeSelector: {}
  tolerations: []
  affinity: {}

# -----------------------------------------------------------------------------
# Face Recognition Service (InsightFace)
# -----------------------------------------------------------------------------
recognition:
  enabled: false
  replicaCount: 1

  image:
    repository: orbo-recognition
    tag: latest
    pullPolicy: IfNotPresent

  # Recognition settings
  config:
    similarityThreshold: 0.5  # 0.0-1.0, higher = stricter matching
    model: buffalo_l  # InsightFace model: buffalo_l, buffalo_s, buffalo_sc

  # Service configuration
  service:
    type: ClusterIP
    port: 8082

  # Persistence for face database
  persistence:
    enabled: true
    size: 1Gi
    accessMode: ReadWriteOnce
    storageClass: ""

  # CPU-only resources
  resources:
    limits:
      cpu: 2000m
      memory: 4Gi
    requests:
      cpu: 1000m
      memory: 2Gi

  # Security context
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    runAsGroup: 1000
    fsGroup: 1000
    allowPrivilegeEscalation: false
    capabilities:
      drop: [ALL]

  # Scheduling
  nodeSelector: {}
  tolerations: []
  affinity: {}

# -----------------------------------------------------------------------------
# DINOv3 Service (Disabled)
# -----------------------------------------------------------------------------
dinov3:
  enabled: false
  replicaCount: 1

  image:
    repository: orbo-dinov3
    tag: latest
    pullPolicy: Always

  config:
    motionThreshold: 0.85
    confidenceThreshold: 0.6
    fallbackToBasic: true
    enableSceneAnalysis: true

  service:
    type: ClusterIP
    port: 8001

  resources:
    limits:
      cpu: 2000m
      memory: 4Gi
    requests:
      cpu: 1000m
      memory: 2Gi

  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    runAsGroup: 1000
    fsGroup: 1000
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: false
    capabilities:
      drop: [ALL]

  gpu:
    enabled: false
    cudaDevices: "0"
    nodeSelector: {}

  nodeSelector: {}
  tolerations: []
  affinity: {}

# -----------------------------------------------------------------------------
# Notifications
# -----------------------------------------------------------------------------
notifications:
  telegram:
    enabled: false
    botToken: ""
    chatId: ""
    cooldownSeconds: 30

# -----------------------------------------------------------------------------
# Storage
# -----------------------------------------------------------------------------
storage:
  # Persistent volume for frames and database
  persistence:
    enabled: true
    storageClass: ""
    accessMode: ReadWriteOnce
    size: 10Gi
    mountPath: /app/frames

  # Database
  database:
    path: /app/frames/orbo.db

  # Frame storage
  frames:
    path: /app/frames

# -----------------------------------------------------------------------------
# Camera Configuration
# -----------------------------------------------------------------------------
camera:
  devicePath: /dev/video0
  privileged: false

# -----------------------------------------------------------------------------
# Networking
# -----------------------------------------------------------------------------
service:
  type: ClusterIP
  port: 8080

ingress:
  enabled: true
  className: nginx
  annotations: {}
  hosts:
    - host: app.orbo.local
      paths:
        - path: /
          pathType: Prefix
  tls: []

# -----------------------------------------------------------------------------
# Health Checks
# -----------------------------------------------------------------------------
probes:
  liveness:
    enabled: true
    path: /healthz
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  readiness:
    enabled: true
    path: /readyz
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3

# -----------------------------------------------------------------------------
# Autoscaling
# -----------------------------------------------------------------------------
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 3
  targetCPUUtilizationPercentage: 80

# -----------------------------------------------------------------------------
# Service Account
# -----------------------------------------------------------------------------
serviceAccount:
  create: true
  annotations: {}
  name: ""

# -----------------------------------------------------------------------------
# Secrets (Use external secrets in production)
# -----------------------------------------------------------------------------
secrets:
  telegramBotToken: ""
  telegramChatId: ""
